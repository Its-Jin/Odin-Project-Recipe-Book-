"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_memex_memex-project-picker-element_ts"],{54679(a,b,c){c.d(b,{H:()=>f,v:()=>e});var d=c(59753);function e(){let a=document.getElementById("ajax-error-message");a&&(a.hidden=!1)}function f(){let a=document.getElementById("ajax-error-message");a&&(a.hidden=!0)}(0,d.on)("deprecatedAjaxError","[data-remote]",function(a){let b=a.detail,{error:c,text:d}=b;a.currentTarget===a.target&&"abort"!==c&&"canceled"!==c&&(/<html/.test(d)?(e(),a.stopImmediatePropagation()):setTimeout(function(){!a.defaultPrevented&&e()},0))}),(0,d.on)("deprecatedAjaxSend","[data-remote]",function(){f()}),(0,d.on)("click",".js-ajax-error-dismiss",function(){f()})},54650(a,b,c){c.d(b,{Bt:()=>h,DN:()=>k,KL:()=>n,Se:()=>j,qC:()=>o,sw:()=>l});var d=c(59753),e=c(76177),f=c(54679);function g(a,b,c){return a.dispatchEvent(new CustomEvent(b,{bubbles:!0,cancelable:c}))}function h(a,b){b&&(i(a,b),(0,e.j)(b)),g(a,"submit",!0)&&a.submit()}function i(a,b){if(!(a instanceof HTMLFormElement))throw TypeError("The specified element is not of type HTMLFormElement.");if(!(b instanceof HTMLElement))throw TypeError("The specified element is not of type HTMLElement.");if("submit"!==b.type)throw TypeError("The specified element is not a submit button.");if(!a||a!==b.form)throw Error("The specified element is not owned by the form element.")}function j(a,b){if("boolean"==typeof b){if(a instanceof HTMLInputElement)a.checked=b;else throw TypeError("only checkboxes can be set to boolean value")}else{if("checkbox"===a.type)throw TypeError("checkbox can't be set to string value");a.value=b}g(a,"change",!1)}function k(a,b){for(let c in b){let d=b[c],e=a.elements.namedItem(c);e instanceof HTMLInputElement?e.value=d:e instanceof HTMLTextAreaElement&&(e.value=d)}}function l(a){if(!(a instanceof HTMLElement))return!1;let b=a.nodeName.toLowerCase(),c=(a.getAttribute("type")||"").toLowerCase();return"select"===b||"textarea"===b||"input"===b&&"submit"!==c&&"reset"!==c||a.isContentEditable}function m(a){return new URLSearchParams(a)}function n(a,b){let c=new URLSearchParams(a.search),d=m(b);for(let[e,f]of d)c.append(e,f);return c.toString()}function o(a){return m(new FormData(a)).toString()}(0,d.on)("click",".js-remote-submit-button",async function(a){let b=a.currentTarget,c=b.form;a.preventDefault();let d;try{d=await fetch(c.action,{method:c.method,body:new FormData(c),headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})}catch{}d&&!d.ok&&(0,f.v)()})},87738(a,b,c){function d(a,b,c=.1){let d=g(a,b,c);if(d&& -1===b.indexOf("/")){let e=a.substring(a.lastIndexOf("/")+1);d+=g(e,b,c)}return d}function e(a,b,c){if(b){let d=a.innerHTML.trim().match(c||function(a){let b=a.toLowerCase().split(""),c="";for(let d=0;d<b.length;d++){let e=b[d],f=e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&");0===d?c+=`(.*)(${f})`:c+=`([^${f}]*?)(${f})`}return RegExp(`${c}(.*?)$`,"i")}(b));if(!d)return;let e=!1,f=[];for(let g=1;g<d.length;++g){let h=d[g];h&&(g%2==0?e||(f.push("<mark>"),e=!0):e&&(f.push("</mark>"),e=!1),f.push(h))}a.innerHTML=f.join("")}else{let i=a.innerHTML.trim(),j=i.replace(/<\/?mark>/g,"");i!==j&&(a.innerHTML=j)}}c.d(b,{EW:()=>d,Qw:()=>e,qu:()=>h});let f=new Set([" ","-","_"]);function g(a,b,c=.1){let d=a;if(d===b)return 1;let e=d.length,g=0,h=0;for(let i=0;i<b.length;i++){let j=b[i],k=d.indexOf(j.toLowerCase()),l=d.indexOf(j.toUpperCase()),m=Math.min(k,l),n=m> -1?m:Math.max(k,l);if(-1===n)return 0;g+=.1,d[n]===j&&(g+=.1),0===n&&(g+=.9-c,0===i&&(h=1)),f.has(d.charAt(n-1))&&(g+=.9-c),d=d.substring(n+1,e)}let o=b.length,p=g/o,q=(p*(o/e)+p)/2;return h&&q+c<1&&(q+=c),q}function h(a,b){return a.score>b.score?-1:a.score<b.score?1:a.text<b.text?-1:a.text>b.text?1:0}},76177(a,b,c){function d(a){let b=a.closest("form");if(!(b instanceof HTMLFormElement))return;let c=e(b);if(a.name){let d=a.matches("input[type=submit]")?"Submit":"",f=a.value||d;c||((c=document.createElement("input")).type="hidden",c.classList.add("js-submit-button-value"),b.prepend(c)),c.name=a.name,c.value=f}else c&&c.remove()}function e(a){let b=a.querySelector("input.js-submit-button-value");return b instanceof HTMLInputElement?b:null}c.d(b,{j:()=>d,u:()=>e})},95141(a,b,c){function d(a,b,c){if(!b.has(a))throw TypeError("attempted to "+c+" private field on non-instance");return b.get(a)}function e(a,b){var c,e,f=d(a,b,"get");return c=a,(e=f).get?e.get.call(c):e.value}function f(a,b,c){!function(a,b){if(b.has(a))throw TypeError("Cannot initialize the same private elements twice on an object")}(a,b),b.set(a,c)}function g(a,b,c){var e=d(a,b,"set");return!function(a,b,c){if(b.set)b.set.call(a,c);else{if(!b.writable)throw TypeError("attempted to set read only private field");b.value=c}}(a,e,c),c}c.d(b,{Z:()=>q}),(h=i||(i={}))[h.Moved=0]="Moved",h[h.Committed=1]="Committed";var h,i,j=new WeakMap,k=new WeakMap,l=new WeakMap,m=new WeakMap,n=new WeakMap,o=new WeakMap,p=new WeakMap;let q=class VirtualListboxFocusState{isFocused(){return e(this,n)}updateItems(){g(this,k,Array.from(e(this,j).values())),this.isFocused()&&!this.isExistingItemFocused()&&this.focusFirst()}focusFirst(){this.defocusCurrentElement(),g(this,o,0),g(this,l,e(this,k)[0])}focusLast(){this.defocusCurrentElement(),g(this,o,0),g(this,l,e(this,k)[e(this,k).length-1])}focusNext(){let a;if(e(this,l)){let b=e(this,k).indexOf(e(this,l));a=b===e(this,k).length-1?e(this,k)[b]:e(this,k)[b+1]}else a=e(this,k)[0];this.defocusCurrentElement(),g(this,o,0),g(this,l,a)}focusPrev(){let a;if(e(this,l)){let b=e(this,k).indexOf(e(this,l));a=0===b?e(this,k)[0]:-1===b?e(this,k)[0]:e(this,k)[b-1]}else a=e(this,k)[0];this.defocusCurrentElement(),g(this,o,0),g(this,l,a)}focusIndex(a){this.defocusCurrentElement(),a> -1&&a<e(this,k).length?g(this,l,e(this,k)[a]):this.resetFocus(),g(this,o,0)}captureFocus(){this.markRootAsFocused(),document.activeElement!==e(this,j)&&e(this,j).focus(),this.isExistingItemFocused()||this.focusFirst(),e(this,j).addEventListener("focusout",e(this,p))}releaseFocus(){this.markRootAsNotFocused(),e(this,j).removeEventListener("focusout",e(this,p))}resetFocus(){g(this,m,void 0),g(this,l,void 0),this.defocusCurrentElement(),this.commitFocus()}captureFocusElement(a){if(!e(this,l))return;let b=a.get(e(this,l));if(b){let c=b.querySelector("[tabindex]");this.setFocusElement(c)}}restoreFocus(){this.isFocused()&&(this.captureFocus(),this.commitFocus())}setFocusElement(a){g(this,m,a)}handleKeydown(a){if(a instanceof KeyboardEvent)switch(a.key){case"ArrowDown":this.isFocused()&&(this.focusNext(),e(this,j).update()),a.preventDefault(),a.stopPropagation();break;case"ArrowUp":this.isFocused()&&(this.focusPrev(),e(this,j).update()),a.preventDefault(),a.stopPropagation();break;case"Home":this.isFocused()&&(this.focusFirst(),e(this,j).update());break;case"End":this.isFocused()&&(this.focusLast(),e(this,j).update())}}handleClick(a){let b=a.target;if(e(this,j).list.contains(b)){let c=b.closest("[tabindex]"),d=parseInt(b.closest("[aria-posinset]")?.getAttribute("aria-posinset")||"");if(!c||isNaN(d))return;g(this,m,c),this.focusIndex(d-1),e(this,j).update(),this.captureFocus()}}handleRenderFocus(a){this.captureFocusElement(a.rowsCache),this.restoreFocus()}handleFocusChange(a){this.focusIndex(a.index)}markRootAsNotFocused(){g(this,n,!1)}markRootAsFocused(){g(this,n,!0)}isExistingItemFocused(){return e(this,l)&&e(this,k).indexOf(e(this,l))> -1}commitFocus(){this.forceFocusOnElement(),e(this,m)&&(this.updateScrollPosition(),g(this,o,1),e(this,j).setAttribute("aria-activedescendant",e(this,m).id))}forceFocusOnElement(){for(let a of e(this,j).querySelectorAll("[tabindex]"))a.classList.remove("focused");let b=e(this,m);b&&b.classList.add("focused")}defocusCurrentElement(){let a=e(this,m);a&&(a.classList.remove("focused"),g(this,m,void 0))}updateScrollPosition(){if(!e(this,l)||!e(this,m)||1===e(this,o))return;let a=e(this,m),b=e(this,j);this.isItemDetached()?this.scrollIntoView():this.isItemHiddenByTopBorder()?b.scrollTop=a.offsetTop:this.isItemHiddenByBottomBorder()&&(b.scrollTop=a.offsetTop+a.offsetHeight-b.clientHeight)}scrollIntoView(){if(!e(this,m))return;let a=parseInt(e(this,m).getAttribute("data-scrolltop")||"");isNaN(a)||(e(this,j).scrollTop=a)}isItemHiddenByTopBorder(){return!!(e(this,m)&&e(this,j))&&e(this,m).offsetTop<e(this,j).scrollTop}isItemHiddenByBottomBorder(){let a=e(this,j),b=e(this,m);if(!b||!a)return!1;let c=a.scrollTop+a.clientHeight,d=b.offsetTop+b.offsetHeight;return d>c}isItemDetached(){return!!e(this,m)&&!e(this,m).offsetParent}constructor(a){f(this,j,{writable:!0,value:void 0}),f(this,k,{writable:!0,value:void 0}),f(this,l,{writable:!0,value:void 0}),f(this,m,{writable:!0,value:void 0}),f(this,n,{writable:!0,value:!1}),f(this,o,{writable:!0,value:void 0}),f(this,p,{writable:!0,value:void 0}),g(this,j,a),g(this,k,Array.from(a.values())),g(this,p,this.releaseFocus.bind(this)),e(this,j).addEventListener("focus",()=>{this.isExistingItemFocused()?this.captureFocus():(this.captureFocus(),e(this,j).update())}),e(this,j).addEventListener("virtual-list-rendered",a=>this.handleRenderFocus(a)),e(this,j).addEventListener("virtual-list-data-updated",()=>this.updateItems()),e(this,j).addEventListener("virtual-list-activedescendant-changed",a=>this.handleFocusChange(a)),e(this,j).addEventListener("keydown",a=>this.handleKeydown(a)),e(this,j).addEventListener("click",a=>this.handleClick(a))}}},47501(a,b,c){c.r(b),c.d(b,{MemexProjectPickerElement:()=>k});var d,e=c(69567),f=c(87738),g=c(76006),h=c(95141),i=c(54650),j=function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g};let k=(d=new WeakMap,class MemexProjectPickerElement extends HTMLElement{connectedCallback(){if(this.didLoad(),this.multiselect="true"===this.getAttribute("data-multiselect"),this.recentSrc=this.filterElement.src,this.allSrc=this.all.getAttribute("data-src")||"",this.filterElement.filter=(a,b)=>{if(!b)return!0;let c=a.name.trim().toLowerCase(),d=(0,f.EW)(c,b),e=a.number.toString(),g=(0,f.EW)(b,e),h=(0,f.EW)(e,b),i=Math.max(d,g,h),j=i>0?{score:i,text:c}:null;return j&&this.hashedItemScore.set(a,j),i>0},this.list){var a,b,c,e;a=this,b=d,c=new h.Z(this.list),e=function(a,b,c){if(!b.has(a))throw TypeError("attempted to set private field on non-instance");return b.get(a)}(a,b,"set"),function(a,b,c){if(b.set)b.set.call(a,c);else{if(!b.writable)throw TypeError("attempted to set read only private field");b.value=c}}(a,e,c)}let g=this.closest("details.select-menu");g&&this.list&&g.addEventListener("toggle",this.toggleProjectMenu.bind(this)),this.filterElement.addEventListener("virtual-filter-input-filtered",()=>this.filterDone()),this.filterElement.input?.addEventListener("keydown",a=>{"Enter"===a.key&&a.preventDefault()})}filterDone(){this.list.sort((a,b)=>{let c=this.hashedItemScore.get(b),d=this.hashedItemScore.get(a);return d||c?d?c?(0,f.qu)(d,c):-1:1:0})}switchMode(){let a=this.filterInput.value.length>0;a&&this.filterElement.src!==this.allSrc?this.switchToAllProjectsMode():a||this.filterElement.src===this.recentSrc||this.switchToRecentProjectMode()}switchToAllProjectsMode(){this.filterElement.src=this.allSrc,this.filterElement.loading="eager",this.isAllProjectsMode=!0}switchToRecentProjectMode(){this.filterElement.src=this.recentSrc,this.filterElement.loading="eager",this.isAllProjectsMode=!1}showAllProjectsBlankslate(){this.blankslateAllProjects.hidden=!1}hideAllProjectsBlankslate(){this.blankslateAllProjects.hidden=!0}showRecentProjectsBlankslate(){this.blankslateRecentProjects.hidden=!1}hideRecentProjectsBlankslate(){this.blankslateRecentProjects.hidden=!0}showBlankslate(){this.isAllProjectsMode?this.showAllProjectsBlankslate():this.showRecentProjectsBlankslate()}hideBlankslate(){this.isAllProjectsMode?this.hideAllProjectsBlankslate():this.hideRecentProjectsBlankslate()}showLoadingIndicator(){this.loadingIndicator.removeAttribute("hidden")}hideLoadingIndicator(){this.loadingIndicator.setAttribute("hidden","true")}willLoad(){this.loading=!0,this.showLoadingIndicator(),this.hideAllProjectsBlankslate(),this.hideRecentProjectsBlankslate(),this.filterElement.reset()}didLoad(){this.loading=!1,this.hideLoadingIndicator()}willRenderItems(){this.loading||(0===this.list.size?this.showBlankslate():this.hideBlankslate())}renderItem(a){let b={number:a.detail.item.number,name:a.detail.item.name,owner:a.detail.item.owner,selected:this.isProjectSelected(a.detail.item)};a.detail.fragment.append(this.createItem(b)),this.renderedProjects.has(b.number)||this.renderedProjects.set(b.number,b)}toggleItem(a){if(!(a.target instanceof HTMLInputElement)||"checkbox"!==a.target.type)return;let b=a.target.closest("[data-project-number]");if(!b)return;let c=parseInt(b.getAttribute("data-project-number")||"",10),d=this.renderedProjects.get(c);if(!d)return;this.multiselect||this.resetSelectionDiff();let e=b.getAttribute("aria-checked")||"";"true"===e?(d.selected=!1,this.selectionDiff[c]=d,b.setAttribute("aria-checked","false")):(d.selected=!0,this.selectionDiff[c]=d,b.setAttribute("aria-checked","true")),this.serializeSelection(),this.multiselect||this.triggerUpdate(a)}resetSelectionDiff(){this.selectionDiff={}}triggerUpdate(a){this.multiselect&&this.filterElement.clear();let b=document.getElementById("js-project-picker-form"),c=b.querySelector("memex-project-picker-interstitial");if(!this.multiselect&&c){c.show(a);return}for(let d of b.elements)if((d.getAttribute("name")||"").indexOf("projects_changes")> -1){(0,i.Bt)(b);return}}serializeSelection(){for(let[a,b]of(this.submitContainer.replaceChildren(),Object.entries(this.selectionDiff)))this.submitContainer.append(this.createSubmitSelection(b))}isProjectSelected(a){return(this.selectionDiff[a.number]??a).selected}toggleProjectMenu(a){let b=a.target;if(!b||"create"===b.getAttribute("data-button-type"))return;let c=a.target;if(c.open)return this.open=!0,this.onMenuOpen();this.open=!1,this.multiselect&&this.triggerUpdate(a)}onMenuOpen(){this.list.update(),!1===this.loading&&0===this.list.size&&this.filterElement.load()}createSubmitSelection(a){return new e.R(this.selectionTemplate,{name:`projects_changes[${a.number.toString()}]`,checked:a.selected,projectNumber:a.number,projectName:a.name,projectOwner:a.owner,type:a.selected?"checkbox":"hidden"},e.XK)}createItem(a){return new e.R(this.itemTemplate,a,e.XK)}constructor(...a){var b,c,e;super(...a),b=this,e={writable:!0,value:void 0},function(a,b){if(b.has(a))throw TypeError("Cannot initialize the same private elements twice on an object")}(b,c=d),c.set(b,e),this.loading=!0,this.isAllProjectsMode=!1,this.recentSrc="",this.allSrc="",this.selectionDiff={},this.hashedItemScore=new Map,this.multiselect=!0,this.renderedProjects=new Map,this.open=!1}});j([g.fA],k.prototype,"filterElement",void 0),j([g.fA],k.prototype,"list",void 0),j([g.fA],k.prototype,"itemTemplate",void 0),j([g.fA],k.prototype,"selectionTemplate",void 0),j([g.fA],k.prototype,"submitContainer",void 0),j([g.fA],k.prototype,"blankslateAllProjects",void 0),j([g.fA],k.prototype,"blankslateRecentProjects",void 0),j([g.fA],k.prototype,"all",void 0),j([g.fA],k.prototype,"filterInput",void 0),j([g.fA],k.prototype,"loadingIndicator",void 0),k=j([g.Ih],k)}}])
//# sourceMappingURL=app_components_memex_memex-project-picker-element_ts-924df5da160a.js.map